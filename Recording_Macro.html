<!DOCTYPE HTML><html lang=en class="sidebar-visible no-js light"><head><meta charset=UTF-8><title>Recording Macro - Vim reference guide</title><meta content="text/html; charset=utf-8"http-equiv=Content-Type><meta name=description content="Vim reference guide"><meta name=viewport content="width=device-width, initial-scale=1"><meta name=theme-color content=#ffffff><link rel=icon href=favicon.svg><link rel="shortcut icon"href=favicon.png><link rel=stylesheet href=css/variables.css><link rel=stylesheet href=css/general.css><link rel=stylesheet href=css/chrome.css><link rel=stylesheet href=FontAwesome/css/font-awesome.css><link rel=stylesheet href=fonts/fonts.css><link rel=stylesheet href=highlight.css><link rel=stylesheet href=tomorrow-night.css><link rel=stylesheet href=ayu-highlight.css><link rel=stylesheet href=style.css><body><script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script><script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script><script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script><script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script><nav id=sidebar class=sidebar aria-label="Table of contents"><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded affix"><a href=preface.html>Preface</a><li class="chapter-item expanded"><a href=Introduction.html><strong aria-hidden=true>1.</strong> Introduction</a><li class="chapter-item expanded"><a href=Normal_mode.html><strong aria-hidden=true>2.</strong> Normal mode</a><li class="chapter-item expanded"><a href=Command_Line_mode.html><strong aria-hidden=true>3.</strong> Command Line mode</a><li class="chapter-item expanded"><a href=Visual_mode.html><strong aria-hidden=true>4.</strong> Visual mode</a><li class="chapter-item expanded"><a href=Regular_Expressions.html><strong aria-hidden=true>5.</strong> Regular Expressions</a><li class="chapter-item expanded"><a href=Recording_Macro.html class=active><strong aria-hidden=true>6.</strong> Recording Macro</a><li class="chapter-item expanded"><a href=Customizing_vim.html><strong aria-hidden=true>7.</strong> Customizing vim</a></li><br><hr><li class="chapter-item expanded"><i id=git-repository-button class="fa fa-github"></i><a href=https://github.com/learnbyexample/vim_reference>   Source code</a><li class="chapter-item expanded"><i id=home-button class="fa fa-home"></i><a href=https://learnbyexample.github.io/>   My Blog</a><li class="chapter-item expanded"><i id=book-button class="fa fa-book"></i><a href=https://learnbyexample.github.io/books/>   My Books</a><li class="chapter-item expanded"><i id=mail-button class="fa fa-envelope"></i><a href=https://learnbyexample.gumroad.com/l/learnbyexample-weekly>   learnbyexample weekly</a></ol></div><div id=sidebar-resize-handle class=sidebar-resize-handle></div></nav><div id=page-wrapper class=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div id=menu-bar class="menu-bar sticky bordered"><div class=left-buttons><button id=sidebar-toggle class=icon-button type=button title="Toggle Table of Contents"aria-label="Toggle Table of Contents"aria-controls=sidebar><i class="fa fa-bars"></i></button><button id=theme-toggle class=icon-button type=button title="Change theme"aria-label="Change theme"aria-haspopup=true aria-expanded=false aria-controls=theme-list><i class="fa fa-paint-brush"></i></button><ul id=theme-list class=theme-popup aria-label=Themes role=menu><li role=none><button role=menuitem class=theme id=light>Light (default)</button><li role=none><button role=menuitem class=theme id=rust>Rust</button><li role=none><button role=menuitem class=theme id=coal>Coal</button><li role=none><button role=menuitem class=theme id=navy>Navy</button><li role=none><button role=menuitem class=theme id=ayu>Ayu</button></ul><button id=search-toggle class=icon-button type=button title="Search. (Shortkey: s)"aria-label="Toggle Searchbar"aria-expanded=false aria-keyshortcuts=S aria-controls=searchbar><i class="fa fa-search"></i></button></div><h1 class=menu-title>Vim reference guide</h1><div class=right-buttons><a href=https://learnbyexample.github.io title=Blog aria-label=Blog> <i id=home-button class="fa fa-home"></i> </a><a href=https://github.com/learnbyexample/vim_reference title="Git repository"aria-label="Git repository"> <i id=git-repository-button class="fa fa-github"></i> </a></div></div><div id=search-wrapper class=hidden><form id=searchbar-outer class=searchbar-outer><input type=search id=searchbar name=searchbar placeholder="Search this book ..."aria-controls=searchresults-outer aria-describedby=searchresults-header></form><div id=searchresults-outer class="searchresults-outer hidden"><div id=searchresults-header class=searchresults-header></div><ul id=searchresults></ul></div></div><script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script><div id=content class=content><main><div class=sidetoc><nav class=pagetoc></nav></div><h1 id=recording-macro><a class=header href=#recording-macro>Recording Macro</a></h1><h2 id=need-for-macro><a class=header href=#need-for-macro>Need for Macro</a></h2><p>The repeat command can only repeat the last change. It also gets overwritten with every editing command. The <code>q</code> command allows user to record any sequence of editing commands to effectively create a user defined command, which can then be applied on other text across files. It can also be prefixed with a number to repeat the command. Powerful indeed!<p>Steps:<ul><li>Press <code>q</code> to start recording session<li>Use any alphabet to store the recording, say <code>a</code><li>Use the various editing commands in combination with movement commands to accomplish the sequence of editing required<li>Press <code>q</code> again to stop recording<li>Use <code>@a</code> (the alphabet typed in step 2) to execute the recorded command elsewhere <ul><li><code>5@a</code> execute 5 times<li><code>@@</code> execute last recorded macro</ul></ul><h2 id=example-1><a class=header href=#example-1>Example 1</a></h2><ul><li><code>qwceHello&LTEsc>q</code> <ul><li><code>q</code> start recording<li>save recording to <code>w</code> register<li><code>ce</code> change till end of word<li><code>Hello</code> literally type these characters<li><code>&LTEsc></code> denotes pressing <code>Esc</code> key, one can type it in Insert or Command Line mode by pressing <code>Ctrl+v</code> followed by pressing <code>Esc</code> key <ul><li>Note-1: It looks like <code>^[</code> but is a single character<li>Note-2: if you are using <code>gvim</code> and <code>Ctrl+v</code> is mapped to something else, <code>Ctrl+q</code> can be used instead</ul><li><code>q</code> stop recording<li>Now, in Normal mode, wherever you press <code>@w</code>, it will clear text until end of word and insert the characters <code>Hello</code><li>To use the last recorded macro, <code>@@</code> can be used without having to remember which register was used to save the recording</ul></ul><p>What if you made a mistake and you wanted <code>'Hello!'</code> instead of <code>Hello</code>? Instead of meticulously recording the sequence again, we can take advantage of the fact that we are using registers to record and play the macro<ul><li><code>"wp</code> will paste contents of <code>w</code> register, which is <code>ceHello&LTEsc></code> <ul><li>Note that in Vim, it will look like <code>ceHello^[</code></ul><li>change it to <code>ce'Hello!'&LTEsc></code><li>then visually text the sequence and press <code>"wy</code> to replace the contents of <code>w</code> register to this new sequence <ul><li>this can be achieved in non-visual mode as well by placing cursor at start of sequence and then <code>"wy</code> followed by appropriate movement to copy till end of sequence</ul><li>now <code>@w</code> will clear text until end of word and insert the characters <code>'Hello!'</code><li>to use this recording in a portable manner, add <code>let @w = "ce'Hello!'&LTEsc>"</code> to <code>~/.vimrc</code> <ul><li>Note again that you need to type the <code>&LTEsc></code> key using <code>Ctrl+v</code> followed by <code>Esc</code> key in Insert mode</ul></ul><p>Now, suppose, you wanted to change only the starting word of a line, irrespective of where the current position of cursor is<ul><li><code>^ce'Hello!'&LTEsc></code></ul><p>How about changing starting word of multiple lines bunched together?<ul><li><code>^ce'Hello!'&LTEsc>j</code> we need to first end the recording by going to next line<li><code>5@w</code> whatever count of lines to modify</ul><p>Hmm, all this is fine, but how to change only those lines in the file whose starting word is <code>Hi</code> to <code>'Hello!'</code> And they are not bunched next to each other<ul><li><code>:g/^Hi/ normal @w</code> use the <code>:g</code> command to filter the lines and then execute the Normal mode command <code>@w</code><li>Note: This particular editing can easily be done using <code>:% s/^Hi/'Hello!'/</code> This example was used to only show how to use the <code>q</code> macro recording</ul><h2 id=example-2><a class=header href=#example-2>Example 2</a></h2><p>Suppose, we forgot braces in Perl for single statement control structures<pre><code class=language-perl>if($a > 4)
    print "$a is greater than 4\n";

# some other code here

if($word eq reverse($word))
    print "$word is a palindrome\n";
</code></pre><ul><li><code>o{&LTEsc>jo}&LTEsc></code> record the sequence for one statement in a register say <code>p</code><li><code>:g/\&LTif(/ normal @p</code> execute the macro for all occurences<li>When dealing with multiple lines, recording macro with <code>q</code> might be cleaner than using <code>:s</code></ul><pre><code class=language-perl>if($a > 4)
{
    print "$a is greater than 4\n";
}

# some other code here

if($word eq reverse($word))
{
    print "$word is a palindrome\n";
}
</code></pre><h2 id=example-3><a class=header href=#example-3>Example 3</a></h2><p>Suppose we need to convert these lines in markdown text<pre><code># Intro Guide
# Basic steps
# Advanced Usage
# Further Reading
</code></pre><p>to table of contents, like this<pre><code>* [Intro Guide](#intro-guide)
* [Basic steps](#basic-steps)
* [Advanced Usage](#advanced-usage)
* [Further Reading](#further-reading)
</code></pre><ul><li><code>$T>d$0r*la[&LTEsc>pa]&LTEsc>lcf"(#&LTEsc>f"C)&LTEsc>j</code> say this is saved in <code>b</code> register <ul><li><code>$</code> move to end of line<li><code>T></code> move to character after last occurence of '>' in the line<li><code>d$</code> delete upto end of line<li><code>0</code> move to first column of line<li><code>r*</code> replace '#' with '*'<li><code>l</code> move cursor one character right<li><code>a[&LTEsc></code> append '[' and change to Normal mode<li><code>p</code> paste the earlier deleted content<li><code>a]&LTEsc></code> append ']' and change to Normal mode<li><code>lcf"(#&LTEsc></code> move cursor one character right, clear text upto next double quote, insert '(#' and change to Normal mode<li><code>f"C)&LTEsc>j</code> move cursor to next double quote, clear text till end of line, insert ')', change to Normal mode and move cursor one line down</ul><li><code>4@b</code> on first line, as they are bunched together <ul><li>or <code>vip: normal @b</code></ul><li>Note: again, this is a demonstration and <code>s/\v.*"(.*)".*\>(.*)/* [\2](#\1)/</code> is perhaps better option</ul><h2 id=further-reading><a class=header href=#further-reading>Further Reading</a></h2><ul><li><a href=https://medium.com/usevim/vim-101-a-gentle-introduction-to-macros-db6b066e5b38>A Gentle Introduction to Macros</a><li><a href=https://sanctum.geek.nz/arabesque/advanced-vim-macros/>Advanced vim macros</a><li><a href=https://vi.stackexchange.com/search?tab=votes&q=macro>macro Q&A on vi stackexchange</a></ul></main><nav class=nav-wrapper aria-label="Page navigation"><a rel=prev href=Regular_Expressions.html class="mobile-nav-chapters previous"title="Previous chapter"aria-label="Previous chapter"aria-keyshortcuts=Left> <i class="fa fa-angle-left"></i> </a><a rel=next href=Customizing_vim.html class="mobile-nav-chapters next"title="Next chapter"aria-label="Next chapter"aria-keyshortcuts=Right> <i class="fa fa-angle-right"></i> </a><div style="clear: both"></div></nav></div></div><nav class=nav-wide-wrapper aria-label="Page navigation"><a rel=prev href=Regular_Expressions.html class="nav-chapters previous"title="Previous chapter"aria-label="Previous chapter"aria-keyshortcuts=Left> <i class="fa fa-angle-left"></i> </a><a rel=next href=Customizing_vim.html class="nav-chapters next"title="Next chapter"aria-label="Next chapter"aria-keyshortcuts=Right> <i class="fa fa-angle-right"></i> </a></nav></div><script>
            window.playground_copyable = true;
        </script><script src=elasticlunr.min.js charset=utf-8></script><script src=mark.min.js charset=utf-8></script><script src=searcher.js charset=utf-8></script><script src=clipboard.min.js charset=utf-8></script><script src=highlight.js charset=utf-8></script><script src=book.js charset=utf-8></script><script src=sidebar.js></script>